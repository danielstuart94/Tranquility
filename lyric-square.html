<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Tqind ¬∑ Lyric Square, Hammersmith</title>
  <link rel="icon" href="favicon.ico"/>
  <meta name="description" content="Tqind demo for Lyric Square, Hammersmith. Public tranquillity score with advice."/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat+Alternates:wght@600&family=Nunito+Sans:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --brand-teal:#3A8C82;
      --brand-grey:#6E6E6E;
      --brand-sky:#78B9D1;
      --bg:#F9F9F7;
      --green:#2FBF71;
      --amber:#F2A900;
      --red:#E2554D;
      --text:#1c1f24;
      --muted:#5a616b;
      --card:#ffffff;
      --ring-grey:#B8B8B8;
      --focus:#0b6cff;
      --radius:16px;
      --space:24px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:var(--bg);color:var(--text);
      font:16px/1.6 "Nunito Sans", ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial;
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    }
    h1,h2,h3{font-family:"Montserrat Alternates","Montserrat Rounded",system-ui; margin:0 0 6px}
    .container{max-width:920px;margin:0 auto;padding:0 16px}
    /* Header */
    header{position:sticky;top:0;background:rgba(249,249,247,.9);backdrop-filter:saturate(120%) blur(8px);
      border-bottom:1px solid #e8e8e4; z-index:10}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:10px 0}
    .brand{display:flex;align-items:center;gap:10px}
    .brand img{height:32px;width:32px;border-radius:10px}
    .loc{font-weight:600}
    .loc small{display:block;font-weight:400;color:var(--muted);font-size:12px}
    a{color:var(--brand-teal);text-decoration:none}
    a:focus,button:focus,[role="button"]:focus{outline:3px solid var(--focus);outline-offset:2px}
    /* Sections */
    section{padding:24px 0}
    .card{background:var(--card);border:1px solid #eee;border-radius:var(--radius);padding:16px}
    /* Hero */
    .hero{display:grid;grid-template-columns:1fr;gap:16px;align-items:center}
    @media(min-width:720px){.hero{grid-template-columns:220px 1fr}}
    .score-wrap{position:relative; width:220px; height:220px; margin:0 auto}
    .score-svg{transform:rotate(-90deg)}
    .score-num{position:absolute;inset:0;display:grid;place-items:center;font-size:40px;font-weight:700}
    .score-label{position:absolute;left:50%;transform:translateX(-50%);bottom:-6px;font-size:12px;color:var(--muted)}
    .advice{font-size:18px;color:var(--text)}
    .meta{font-size:12px;color:var(--muted)}
    .tag{display:inline-block;background:#eef6f5;color:#1f4a46;border-radius:999px;padding:4px 10px;font-size:12px}
    /* Forecast */
    .chart{width:100%;height:180px}
    .legend{display:flex;gap:10px;align-items:center;font-size:12px;color:var(--muted);margin-top:6px}
    .legend .dot{width:10px;height:10px;border-radius:50%}
    .row{display:grid;gap:16px}
    @media(min-width:720px){.row{grid-template-columns:1fr 1fr}}
    .icons{display:flex;justify-content:space-between;margin-top:6px}
    .icons span{font-size:12px;color:var(--muted)}
    /* Breakdown cards */
    .list{display:grid;gap:12px}
    .item{border:1px solid #eee;border-radius:14px;background:#fff;overflow:hidden}
    .item summary{list-style:none;cursor:pointer;display:flex;align-items:center;gap:10px;padding:14px}
    .item summary::-webkit-details-marker{display:none}
    .mini-dot{width:10px;height:10px;border-radius:50%}
    .state-green{background:var(--green)} .state-amber{background:var(--amber)} .state-red{background:var(--red)}
    .item .content{padding:0 14px 14px 14px}
    .kv{display:flex;gap:10px;flex-wrap:wrap;font-size:14px;color:var(--muted)}
    .actions{margin-top:8px;display:flex;gap:8px}
    .btn{border:1px solid #dde1e6;background:#fafafa;padding:8px 12px;border-radius:12px;font:inherit;cursor:pointer;transition:transform .18s ease,background .18s ease}
    .btn:hover{transform:translateY(-1px);background:#fff}
    .btn:active{transform:translateY(0)}
    /* Tips */
    .tips li{margin:6px 0;display:flex;gap:8px;align-items:flex-start}
    .tips .ico{width:18px}
    /* CTA */
    .cta{display:flex;flex-direction:column;gap:10px}
    .cta .group{display:flex;gap:8px;flex-wrap:wrap}
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:16px;background:#1f2937;color:#fff;padding:10px 12px;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.2);opacity:0;pointer-events:none;transition:opacity .2s ease}
    .toast.show{opacity:1}
    /* Footer */
    footer{border-top:1px solid #e8e8e4;margin-top:20px}
    footer .foot{display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;padding:14px 0;color:var(--muted);font-size:13px}
    /* Modal */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;padding:16px}
    .modal.open{display:flex}
    .modal .box{background:#fff;color:#111;border-radius:14px;max-width:520px;width:100%;padding:16px;border:1px solid #eee}
    .close{float:right;border:none;background:transparent;font-size:20px;cursor:pointer}
    /* Accessibility helpers */
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
</head>
<body>
  <header role="banner">
    <div class="container nav" aria-label="Top bar">
      <div class="brand">
        <img src="logo.svg" alt="Tqind logo"/>
        <div class="loc" aria-label="Location">Lyric Square, Hammersmith<small>Tqind today</small></div>
      </div>
      <a href="index.html" aria-label="Back to home">Home</a>
    </div>
  </header>

  <main id="main" class="container" role="main">
    <!-- Hero -->
    <section aria-labelledby="hero-title">
      <div class="hero card">
        <div class="score-wrap" aria-live="polite">
          <svg class="score-svg" viewBox="0 0 220 220" width="220" height="220" role="img" aria-label="Tqind score ring">
            <circle cx="110" cy="110" r="94" fill="none" stroke="var(--ring-grey)" stroke-width="16" opacity="0.35"/>
            <circle id="ring" cx="110" cy="110" r="94" fill="none" stroke="var(--green)" stroke-width="16"
              stroke-linecap="round" stroke-dasharray="590" stroke-dashoffset="590"/>
          </svg>
          <div class="score-num"><span id="score">0</span></div>
          <div class="score-label" id="stateLabel">‚Äî</div>
          <div id="offlineLabel" class="tag" style="display:none">offline</div>
        </div>
        <div>
          <h1 id="hero-title">Tqind today</h1>
          <p class="advice" id="advice">Best time to visit: 10:00‚Äì13:00.</p>
          <div class="meta">
            <span id="updated">Updated ‚Äî</span>
            <span class="sr-only"> | </span>
            <button id="what" class="btn" style="margin-left:6px" aria-haspopup="dialog" aria-controls="modal">What is Tqind?</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Forecast + icons -->
    <section aria-labelledby="forecast-title">
      <h2 id="forecast-title">24-hour forecast</h2>
      <div class="row">
        <div class="card">
          <svg id="chart" class="chart" role="img" aria-label="Tqind hourly forecast line chart"></svg>
          <div class="legend"><div class="dot" style="background:var(--brand-teal)"></div> Score by hour (0‚Äì100)</div>
        </div>
        <div class="card">
          <div class="icons" aria-label="Weather and wind">
            <span aria-label="00:00 cloudy moderate breeze">‚òÅÔ∏è 0h</span>
            <span aria-label="06:00 clear light breeze">üå§Ô∏è 6h</span>
            <span aria-label="12:00 clear gentle breeze">‚òÄÔ∏è 12h</span>
            <span aria-label="18:00 light showers">üå¶Ô∏è 18h</span>
            <span aria-label="24:00 cloudy">‚òÅÔ∏è 24h</span>
          </div>
          <p class="meta">Icons illustrative. Hook to Met Office feed when live.</p>
        </div>
      </div>
    </section>

    <!-- Breakdown -->
    <section aria-labelledby="breakdown-title">
      <h2 id="breakdown-title">Breakdown</h2>
      <div class="list" id="breakdownList"></div>
    </section>

    <!-- Tips -->
    <section aria-labelledby="tips-title">
      <h2 id="tips-title">Tips</h2>
      <div class="card">
        <ul class="tips" id="tipsList" aria-label="Visit tips"></ul>
      </div>
    </section>

    <!-- Feedback CTA -->
    <section aria-labelledby="feedback-title">
      <h2 id="feedback-title">Do you agree with today's score?</h2>
      <div class="card cta">
        <div class="group">
          <button class="btn" id="agreeYes">Yes</button>
          <button class="btn" id="agreeNo">No</button>
        </div>
        <label class="sr-only" for="fbtext">Optional comment</label>
        <textarea id="fbtext" rows="3" placeholder="Optional: Tell us why" style="display:none;width:100%;padding:10px;border-radius:12px;border:1px solid #dde1e6;font:inherit"></textarea>
      </div>
    </section>
  </main>

  <footer role="contentinfo">
    <div class="container foot">
      <div>Data: DEFRA, Met Office, OpenStreetMap, Hammersmith & Fulham</div>
      <div>Our mission: get Londoners outdoors for calm urban moments. <a href="privacy.html">Privacy</a> ¬∑ <a href="contact.html">Contact</a></div>
    </div>
  </footer>

  <!-- What is Tqind modal -->
  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-describedby="modalDesc">
    <div class="box">
      <button class="close" aria-label="Close" id="closeModal">√ó</button>
      <h3 id="modalTitle">What is Tqind?</h3>
      <p id="modalDesc">Tqind is a tranquillity score (0‚Äì100) that blends noise, air quality, greenery, shade, and crowding signals. Scores guide when and where a place feels calm and pleasant.</p>
      <p>We publish a simple forecast and plain‚ÄëEnglish advice suitable for the public and policy teams.</p>
    </div>
  </div>

  <!-- Data hook -->
  <script id="data" type="application/json">
  {
    "location": "Lyric Square, Hammersmith",
    "tqind": 78,
    "updated": "2025-09-28T10:00:00Z",
    "forecast": [{"hour":0,"score":62},{"hour":6,"score":71},{"hour":12,"score":82},{"hour":18,"score":74},{"hour":24,"score":68}],
    "factors": {
      "noise": {"value":65,"unit":"dB","state":"amber","source":"DEFRA","meaning":"Raised voice likely"},
      "air": {"value":3,"unit":"/10","state":"green","source":"Met Office","meaning":"Low to moderate"},
      "green": {"value":"Low","state":"amber","source":"OSM","meaning":"Few trees/soft surfaces"},
      "shade": {"value":"Limited","state":"amber","source":"Survey","meaning":"Direct sun at midday"}
    },
    "tips": ["Seek shade 12‚Äì15h", "Market busier 14‚Äì18h", "Chance of showers 17h"]
  }
  </script>

  <script>
  (function(){
    const json = JSON.parse(document.getElementById('data').textContent);
    const scoreEl = document.getElementById('score');
    const ring = document.getElementById('ring');
    const stateLabel = document.getElementById('stateLabel');
    const offline = document.getElementById('offlineLabel');
    const updated = document.getElementById('updated');

    if(!navigator.onLine){
      offline.style.display='inline-block';
      ring.setAttribute('stroke','var(--ring-grey)');
    }

    function stateFor(v){
      if(v>=70) return {name:'Green', color:'var(--green)'};
      if(v>=40) return {name:'Amber', color:'var(--amber)'};
      return {name:'Red', color:'var(--red)'};
    }
    function fmtTime(iso){
      try{ const d=new Date(iso); return d.toLocaleString([], {hour:'2-digit', minute:'2-digit'}) + ' today'; }catch{ return '‚Äî'; }
    }
    updated.textContent = 'Updated ' + fmtTime(json.updated);

    const circumference = 2*Math.PI*94;
    ring.setAttribute('stroke-dasharray', String(circumference));
    ring.setAttribute('stroke-dashoffset', String(circumference));
    const target = Math.max(0, Math.min(100, json.tqind));
    const state = stateFor(target);
    ring.setAttribute('stroke', state.color);
    stateLabel.textContent = state.name;
    const dur=900; const t0=performance.now();
    function step(t){
      const k=Math.min(1,(t-t0)/dur);
      const val=Math.round(target*k);
      scoreEl.textContent=String(val);
      const off=circumference*(1 - val/100);
      ring.setAttribute('stroke-dashoffset', String(off));
      if(k<1) requestAnimationFrame(step);
    }
    requestAnimationFrame(step);

    document.getElementById('advice').textContent = "Best time to visit: 10:00‚Äì13:00.";

    const pts = json.forecast;
    const svg = document.getElementById('chart');
    const W = svg.clientWidth || 600, H = svg.clientHeight || 180;
    const pad = 10, x0=pad, x1=W-pad, y0=H-18, y1=12;
    const hours=[0,6,12,18,24];
    function xFor(h){ return x0 + (x1-x0)*(h/24); }
    function yFor(s){ return y0 - (y0-y1)*(s/100); }
    svg.setAttribute('viewBox', `0 0 ${W} ${H}`);
    const axis = document.createElementNS('http://www.w3.org/2000/svg','g');
    hours.forEach(h=>{
      const x=xFor(h);
      const t=document.createElementNS('http://www.w3.org/2000/svg','text');
      t.setAttribute('x', x); t.setAttribute('y', H-2);
      t.setAttribute('text-anchor','middle'); t.setAttribute('font-size','11'); t.setAttribute('fill','#7a7f87');
      t.textContent=String(h);
      axis.appendChild(t);
    });
    svg.appendChild(axis);
    const d = pts.map((p,i)=> (i===0?'M':'L') + xFor(p.hour) + ' ' + yFor(p.score)).join(' ');
    const path = document.createElementNS('http://www.w3.org/2000/svg','path');
    path.setAttribute('d', d);
    path.setAttribute('fill','none');
    path.setAttribute('stroke','var(--brand-teal)');
    path.setAttribute('stroke-width','3');
    path.setAttribute('stroke-linecap','round');
    svg.appendChild(path);
    pts.forEach(p=>{
      const c = document.createElementNS('http://www.w3.org/2000/svg','circle');
      c.setAttribute('cx', xFor(p.hour)); c.setAttribute('cy', yFor(p.score));
      c.setAttribute('r','3.5'); c.setAttribute('fill','var(--brand-sky)');
      c.setAttribute('aria-label', `Hour ${p.hour}, score ${p.score}`);
      svg.appendChild(c);
    });

    const list = document.getElementById('breakdownList');
    const defs = [
      {key:'noise', label:'Noise', aria:'noise moderate'},
      {key:'air', label:'Air quality', aria:'air quality low to moderate'},
      {key:'green', label:'Green/Nature', aria:'greenery low'},
      {key:'shade', label:'Shade/Shelter', aria:'shade limited'}
    ];
    defs.forEach(def=>{
      const f = json.factors[def.key];
      const details = document.createElement('details');
      details.className='item';
      details.innerHTML = `
        <summary aria-label="${def.aria}">
          <span class="mini-dot state-${f.state}"></span>
          <strong style="flex:1">${def.label}</strong>
          <span class="small">${f.value}${f.unit?(' '+f.unit):''}</span>
        </summary>
        <div class="content">
          <div class="kv"><strong>${f.value}${f.unit?(' '+f.unit):''}</strong> ‚Äî ${f.meaning}</div>
          <div class="kv">Source: <span>${f.source}</span></div>
          <div class="actions" role="group" aria-label="Confirm current status">
            <button class="btn" data-k="${def.key}" data-v="yes">Still true now? Yes</button>
            <button class="btn" data-k="${def.key}" data-v="no">No</button>
          </div>
        </div>`;
      list.appendChild(details);
    });
    list.addEventListener('click', (e)=>{
      const t=e.target;
      if(!(t instanceof HTMLElement)) return;
      if(t.matches('button[data-k]')){
        console.log('feedback-factor', {factor:t.dataset.k, agree:t.dataset.v});
        showToast('Thanks for the update.');
      }
    });

    const tipsList = document.getElementById('tipsList');
    const ico = ['‚òÇÔ∏è','üå≥','üï∂Ô∏è'];
    json.tips.slice(0,3).forEach((tip,i)=>{
      const li=document.createElement('li');
      li.innerHTML = `<span class="ico" aria-hidden="true">${ico[i]||'‚ÑπÔ∏è'}</span><span>${tip}</span>`;
      tipsList.appendChild(li);
    });

    const yes = document.getElementById('agreeYes');
    const no = document.getElementById('agreeNo');
    const box = document.getElementById('fbtext');
    yes.addEventListener('click', ()=>{ console.log('feedback-score',{agree:true}); box.style.display='none'; showToast('Thanks for your feedback.'); });
    no.addEventListener('click', ()=>{ console.log('feedback-score',{agree:false}); box.style.display='block'; box.focus(); showToast('Thanks. You can add a note.'); });

    const modal = document.getElementById('modal');
    document.getElementById('what').addEventListener('click', ()=> modal.classList.add('open'));
    document.getElementById('closeModal').addEventListener('click', ()=> modal.classList.remove('open'));
    modal.addEventListener('click', (e)=>{ if(e.target===modal) modal.classList.remove('open'); });

    function showToast(msg){
      let t=document.querySelector('.toast');
      if(!t){ t=document.createElement('div'); t.className='toast'; document.body.appendChild(t); }
      t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 1600);
    }
  })();
  </script>
</body>
</html>